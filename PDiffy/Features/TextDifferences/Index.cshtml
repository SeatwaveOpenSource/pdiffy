@model IList<PDiffy.Features.TextDifferences.Index.Model>

@{
	Layout = "~/Features/Shared/_Layout.cshtml";
}
@section Styles {
	<link href="~/Styles/TextDifferences.css" rel="stylesheet" />
}
@section Scripts {
	<script src="~/Scripts/TextDifferences.generated.js" type="text/javascript"></script>
}


<aside class="toggles">
	<span>@Model.Count items compared.</span>
</aside>
<br />
<br />

<aside class="toggles">
	@foreach (var site in Model.GroupBy(_ => _.Site))
	{
		<div>
			<input id="cmn-toggle-@site.Key.Replace(" ","__")" name="siteToggle" toggles="site" type="checkbox" class="input-toggle" />
			<label for="cmn-toggle-@site.Key.Replace(" ", "__")">@string.Format("{0} ({1})", site.Key, @Model.Where(_ => _.Site == site.Key).Count())</label>
		</div>
	}
</aside>
<aside class="toggles">

	@foreach (var page in Model.GroupBy(_ => _.Page))
	{
		<div>
			<input id="cmn-toggle-@page.Key.Replace(" ", "__")" name="pageToggle" toggles="page" type="checkbox" class="input-toggle" />
			<label for="cmn-toggle-@page.Key.Replace(" ", "__")">@string.Format("{0} ({1})", page.Key, @Model.Where(_ => _.Page == page.Key).Count())</label>
		</div>
	}
</aside>

<div class="page-container align-center text-align-center">
	@foreach (var textComparison in Model.Reverse())
	{
		<div class="page-object align-center text-align-center" style="display:none;">
			@{ var values = new { name = textComparison.Name, page = textComparison.Page, site = textComparison.Site }; }

			<h3>@textComparison.Name</h3>
			<span class="site">@textComparison.Site</span> | <span class="page">@textComparison.Page</span>

			@if (textComparison.HumanComparisonRequired)
			{ <p class="comparison">@textComparison.LastComparisonDate</p> }
			else if (textComparison.ComparisonStillValid)
			{ <p class="comparison valid">@textComparison.LastComparisonDate</p> }
			else
			{ <p class="comparison invalid">@textComparison.LastComparisonDate</p>}

			<div class="texts">
				<div class="original-text">
					<p class="pre-wrap-white-space">@textComparison.OriginalText</p>

				</div>
				@if (textComparison.ComparisonExists)
				{
					<div class="comparison-text">
						<p class="pre-wrap-white-space">@textComparison.ComparisonText</p>
					</div>
				}
				<div class="differences-text">
					<p>@Html.Raw(Server.HtmlDecode(textComparison.DifferenceText.Replace("&amp;para;", string.Empty)))</p>
				</div>
			</div>

			<div class="controls">
				@if (textComparison.HumanComparisonRequired)
				{
					@Html.ActionLink("Approve Difference", "Approve", "TextDifferences", values, new { @class = "btn" })
				}

				<a class="btn align-center" href="@Url.Action("Index", "History", values)">History</a>

				<a class="btn align-center" href="#@textComparison.Name">Delete</a>
			</div>
			<div id="@textComparison.Name" class="modalDialog">
				<div class="align-center text-align-center">
					<a href="#closedModal" title="Close" class="close">X</a>

					<h3>Delete @textComparison.Name</h3>
					<p>Warning! Read this!</p>
					<p>This will delete this comparison and the history for it.</p>
					@Html.ActionLink("#$@&! the police", "Delete", values, new { @class = "btn danger" })
				</div>
			</div>
		</div>
	}
	<br />
	<br />
	@if (Model.Any())
	{
		<a class="btn danger align-center" href="#deleteAll">Delete All</a>
		<div id="deleteAll" class="modalDialog">
			<div class="align-center text-align-center">
				<a href="#closedModal" title="Close" class="close">X</a>

				<h3>Delete All</h3>
				<p>Warning! Read this!</p>
				<p>This will delete all pages and all history.</p>
				@Html.ActionLink("#$@&! the police", "DeleteAll", new { deleteAll = true }, new { @class = "btn danger" })
			</div>
		</div>
	}
</div>
